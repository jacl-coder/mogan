#!/usr/bin/env elvish

var tag = $args[0]

var tmp = (mktemp -d '/tmp/goldfish-'$tag'-XXX')
echo $tmp

git clone --branch $tag --single-branch --filter blob:none ssh://forgejo@code.liiistem.cn/LiiiLabs/liii.git $tmp

rm -rf TeXmacs/plugins/goldfish/goldfish/liii/*
rm -rf TeXmacs/plugins/goldfish/goldfish/scheme/*
rm -rf TeXmacs/plugins/goldfish/goldfish/srfi/*

cp $tmp/src/goldfish.cpp TeXmacs/plugins/goldfish/src/scheme.cpp
cp $tmp/src/goldfish.hpp TeXmacs/plugins/goldfish/src/

cp -r $tmp/goldfish/* TeXmacs/plugins/goldfish/goldfish/
